<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåç Global Uptime Monitor</title>
<style>
  body { background:#121212; color:#fff; font-family: Arial, sans-serif; margin:0; padding:0;}
  h1 { text-align:center; color:#0ff; margin:20px 0;}
  #target { width:80%; padding:10px; font-size:16px; margin:0 auto; display:block; border-radius:5px; border:none;}
  #startBtn { display:block; margin:10px auto; padding:10px 20px; font-size:16px; background:#0ff; color:#121212; border:none; border-radius:5px; cursor:pointer;}
  #grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; padding:10px;}
  .card { background:#1e1e1e; padding:10px; border-radius:5px; min-height:80px; font-size:14px;}
  .country-name { font-weight:bold; display:flex; align-items:center; gap:5px; font-size:16px;}
  .country-name img { width:25px; height:15px;}
  .ok { color:#00ff88; }
  .err { color:#ff4444; }
  canvas { display:block; margin:20px auto; background:#1e1e1e; border-radius:10px; padding:10px; max-width:95%;}
</style>
</head>
<body>

<h1>üåç Global Uptime Monitor</h1>
<input id="target" placeholder="Enter URL e.g https://example.com" />
<button id="startBtn">Start</button>

<div id="grid"></div>

<canvas id="chart" width="800" height="400"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const countries = [
  {name:"Indonesia", flag:"https://flagcdn.com/id.svg"},
  {name:"India", flag:"https://flagcdn.com/in.svg"},
  {name:"China", flag:"https://flagcdn.com/cn.svg"},
  {name:"Japan", flag:"https://flagcdn.com/jp.svg"},
  {name:"Korea", flag:"https://flagcdn.com/kr.svg"},
  {name:"Singapore", flag:"https://flagcdn.com/sg.svg"},
  {name:"USA", flag:"https://flagcdn.com/us.svg"},
  {name:"UK", flag:"https://flagcdn.com/gb.svg"},
  {name:"Germany", flag:"https://flagcdn.com/de.svg"},
  {name:"France", flag:"https://flagcdn.com/fr.svg"},
  {name:"Australia", flag:"https://flagcdn.com/au.svg"},
  {name:"Brazil", flag:"https://flagcdn.com/br.svg"},
  {name:"Canada", flag:"https://flagcdn.com/ca.svg"},
  {name:"Russia", flag:"https://flagcdn.com/ru.svg"},
  {name:"Netherlands", flag:"https://flagcdn.com/nl.svg"},
  {name:"Sweden", flag:"https://flagcdn.com/se.svg"},
  {name:"UAE", flag:"https://flagcdn.com/ae.svg"},
  {name:"Malaysia", flag:"https://flagcdn.com/my.svg"},
  {name:"Thailand", flag:"https://flagcdn.com/th.svg"},
  {name:"Philippines", flag:"https://flagcdn.com/ph.svg"}
];

let chart, success=0, total=0;

function initChart(){
  const ctx = document.getElementById("chart").getContext("2d");
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: "Uptime %",
        data: [],
        borderColor: "#0ff",
        backgroundColor: "rgba(0,255,255,0.1)",
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      animation: false,
      responsive: true,
      scales: { y: { min:0, max:100 } }
    }
  });
}

async function check(url, country, card){
  try{
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 15000);
    const start = Date.now();

    const res = await fetch(`/api/check?url=${encodeURIComponent(url)}`, {signal: controller.signal});
    clearTimeout(timeout);
    const data = await res.json();

    total++;
    if(data.status === 200) success++;
    const uptime = ((success/total)*100).toFixed(2);

    card.innerHTML = `
      <div class="country-name"><img src="${country.flag}">${country.name}</div>
      <div class="${data.status===200?'ok':'err'}">
        ${data.status||"ERROR"}<br>${data.statusText||data.message}
      </div>
    `;

    chart.data.labels.push(new Date().toLocaleTimeString() + " - " + country.name);
    chart.data.datasets[0].data.push(uptime);
    chart.update();

    if(data.status !== 200) console.log(`[${country.name}] ${data.status||"ERROR"} ${data.statusText||data.message}`);
  } catch(e){
    card.innerHTML = `
      <div class="country-name"><img src="${country.flag}">${country.name}</div>
      <div class="err">Network Error / Broken Pipe</div>
    `;
    console.log(`[${country.name}] ${e.message}`);
  }
}

function start(){
  const url = document.getElementById("target").value;
  if(!url) return alert("Enter URL");

  document.getElementById("grid").innerHTML="";
  success=0;
  total=0;
  initChart();

  countries.forEach((country,index)=>{
    const card=document.createElement("div");
    card.className="card";
    card.style.textAlign = index%2===0?"left":"right";
    document.getElementById("grid").appendChild(card);

    async function loopCheck(){
      await check(url,country,card);
      setTimeout(loopCheck,5000);
    }

    loopCheck();
  });
}

document.getElementById("startBtn").addEventListener("click", start);
</script>

</body>
</html>
