<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåç Global Uptime Monitor</title>
<style>
  body {
    background:#121212;
    color:#fff;
    font-family: Arial, sans-serif;
    margin:0;
    padding:0;
  }
  h1 {
    text-align:center;
    color:#0ff;
    margin:20px 0;
  }
  #controls {
    width:90%;
    max-width:600px;
    margin:0 auto 20px auto;
    display:flex;
    gap:10px;
  }
  #target {
    flex:1;
    padding:10px;
    font-size:16px;
    border-radius:5px;
    border:2px solid #222; /* pinggiran gelap */
    background:#333;      /* abu */
    color:#fff;           /* teks putih */
  }
  #startBtn {
    padding:10px 20px;
    font-size:16px;
    border:none;
    border-radius:5px;
    background:#0ff;
    color:#121212;
    cursor:pointer;
  }
  #grid {
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
    padding:10px;
  }
  .card {
    background:#1e1e1e;
    padding:15px;
    border-radius:8px;
    min-height:80px;
    font-size:14px;
  }
  .country-name {
    font-weight:bold;
    display:flex;
    align-items:center;
    gap:5px;
    font-size:16px;
  }
  .country-name img { width:25px; height:15px; }
  .ok { color:#00ff88; }
  .err { color:#ff4444; }
</style>
</head>
<body>

<h1>üåç Global Uptime Monitor</h1>

<div id="controls">
  <input id="target" placeholder="Enter URL e.g https://example.com" />
  <button id="startBtn">Start</button>
</div>

<div id="grid"></div>

<script>
const countries = [
  {name:"Indonesia", flag:"https://flagcdn.com/id.svg"},
  {name:"India", flag:"https://flagcdn.com/in.svg"},
  {name:"China", flag:"https://flagcdn.com/cn.svg"},
  {name:"Japan", flag:"https://flagcdn.com/jp.svg"},
  {name:"Korea", flag:"https://flagcdn.com/kr.svg"},
  {name:"Singapore", flag:"https://flagcdn.com/sg.svg"},
  {name:"USA", flag:"https://flagcdn.com/us.svg"},
  {name:"UK", flag:"https://flagcdn.com/gb.svg"},
  {name:"Germany", flag:"https://flagcdn.com/de.svg"},
  {name:"France", flag:"https://flagcdn.com/fr.svg"},
  {name:"Australia", flag:"https://flagcdn.com/au.svg"},
  {name:"Brazil", flag:"https://flagcdn.com/br.svg"},
  {name:"Canada", flag:"https://flagcdn.com/ca.svg"},
  {name:"Russia", flag:"https://flagcdn.com/ru.svg"},
  {name:"Netherlands", flag:"https://flagcdn.com/nl.svg"},
  {name:"Sweden", flag:"https://flagcdn.com/se.svg"},
  {name:"UAE", flag:"https://flagcdn.com/ae.svg"},
  {name:"Malaysia", flag:"https://flagcdn.com/my.svg"},
  {name:"Thailand", flag:"https://flagcdn.com/th.svg"},
  {name:"Philippines", flag:"https://flagcdn.com/ph.svg"}
];

async function check(url, country, card){
  try{
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 15000);
    const start = Date.now();

    const res = await fetch(`/api/check?url=${encodeURIComponent(url)}`, {signal: controller.signal});
    clearTimeout(timeout);
    const data = await res.json();
    const ping = Date.now() - start;

    card.innerHTML = `
      <div class="country-name"><img src="${country.flag}">${country.name}</div>
      <div class="${data.status===200?'ok':'err'}">
        ${data.status||"ERROR"} - ${ping} ms
      </div>
    `;

    if(data.status !== 200) console.log(`[${country.name}] ${data.status||"ERROR"} ${data.statusText||data.message}`);
  } catch(e){
    card.innerHTML = `
      <div class="country-name"><img src="${country.flag}">${country.name}</div>
      <div class="err">Network Error / Broken Pipe</div>
    `;
    console.log(`[${country.name}] ${e.message}`);
  }
}

function startMonitoring(){
  const url = document.getElementById("target").value;
  if(!url) return alert("Enter a URL first");

  document.getElementById("grid").innerHTML = "";

  countries.forEach((country,index)=>{
    const card = document.createElement("div");
    card.className="card";
    card.style.textAlign = index%2===0 ? "left":"right";
    document.getElementById("grid").appendChild(card);

    async function loopCheck(){
      await check(url,country,card);
      setTimeout(loopCheck,5000);
    }

    loopCheck();
  });
}

document.getElementById("startBtn").addEventListener("click", startMonitoring);
</script>

</body>
</html>
